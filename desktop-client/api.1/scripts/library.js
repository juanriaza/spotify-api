require(["$api/models"],function(b){function e(a){b.Track._cache.update(a.uris,{starred:"insert"==a.type})}function a(a){b.BridgeLoadable.call(this);var c=b.User.fromURI(a);this.resolve("owner",c);this.resolve("albums",new b.BridgeCollection(b.Album,null,"library_albums",c.uri));this.resolve("artists",new b.BridgeCollection(b.Artist,null,"library_artists",c.uri));this.resolve("playlists",new b.BridgeCollection(b.Playlist,null,"library_playlists",c.uri));this.resolve("published",new b.BridgeCollection(b.Playlist,
null,"library_published",c.uri));this.resolve("starred",b.Playlist.fromURI(c.uri+":starred"));this.resolve("toplist",b.Playlist.fromURI(c.uri+":toplist"));this.resolve("tracks",new b.BridgeCollection(b.Track,a,"library_tracks",c.uri));var d=this;c.uri==b.session.user.uri?(b.Playlist.getOrCreateLibraryListener().proxyTo(this),this.starred.addEventListener("insert",e),this.starred.addEventListener("remove",e)):(a=function(){d.bridgeListen("library_event_wait",[c.uri])},this.playlists._observed=a,this.published._observed=
a);d.albums._observed=function(){d.albums.bridgeListen("library_albums_event_wait",[c.uri])};d.artists._observed=function(){d.artists.bridgeListen("library_artists_event_wait",[c.uri])};d.tracks._observed=function(){d.tracks.bridgeListen("library_tracks_event_wait",[c.uri])}}SP.inherit(a,b.BridgeLoadable);a.fromURI=b.Cache.lookup;a._cache=new b.Cache(a);b.Loadable.define(a,"albums artists owner playlists published starred toplist tracks".split(" "));a.Item;a.prototype.publish=function(a){return b.promisedRequest(this,
"library_publish",[this.owner.uri].concat(SP.uris(arguments)))};a.prototype.star=function(a){return b.promisedRequest(this,"library_star",[this.owner.uri].concat(SP.uris(arguments)))};a.prototype.subscribe=function(a){return b.promisedRequest(this,"library_subscribe",[this.owner.uri].concat(SP.uris(arguments)))};a.prototype.unpublish=function(a){return b.promisedRequest(this,"library_unpublish",[this.owner.uri].concat(SP.uris(arguments)))};a.prototype.unstar=function(a){return b.promisedRequest(this,
"library_unstar",[this.owner.uri].concat(SP.uris(arguments)))};a.prototype.unsubscribe=function(a){return b.promisedRequest(this,"library_unsubscribe",[this.owner.uri].concat(SP.uris(arguments)))};a.forCurrentUser=function(){return a.forUser(b.session.user)};a.forUser=function(b){return a.fromURI(b.uri)};exports.Library=a});
