require(["$api/models"],function(c){function d(a){c.BridgeLoadable.call(this);this.resolve("uri",a);this.resolve("messages",new c.BridgeCollection(b,null,"messaging_conversation_messages",a))}function b(a){c.BridgeLoadable.call(this);this.resolve("uri",a)}SP.inherit(d,c.BridgeLoadable);c.Loadable.define(d,["messages","state","timestamp","uri","users"]);d.prototype._make_timestamp=function(a){return new Date(a)};d.prototype._make_users=function(a){return c.User.fromURIs(a)};d.fromURI=c.Cache.lookup;
d._cache=new c.Cache(d);d.prototype.send=function(a,d){var b=[this.uri,a];d&&b.push(d.uri);return c.promisedRequest(this,"messaging_conversation_reply",b,!0)};SP.inherit(b,c.BridgeLoadable);c.Loadable.define(b,"attachment state text timestamp uri user".split(" "));b.prototype._make_attachment=function(a){return c.fromURI(a)};b.prototype._make_timestamp=function(a){return new Date(a)};b.prototype._make_user=function(a){return c.User.fromURI(a)};b.fromURI=c.Cache.lookup;b._cache=new c.Cache(b);var e=
new c.BridgeCollection(d,null,"messaging_conversations",c.session.user.uri);exports.Conversation=d;exports.Message=b;exports.State={UNREAD:"unread",SEEN:"seen",REPLIED:"replied"};exports.inbox=e;exports.send=function(a,d,b){a=[SP.uris(a),d];b&&a.push(b.uri);b=new c.Promise;SP.request("messaging_send",a,b,b.setDone,b.setFail);return b}});
