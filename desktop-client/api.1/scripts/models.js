var _resolveResult=function(a){this.object.resolveMany(0,a);this.setDone()},_setDone=function(){this.setDone()},promisedRequest=function(a,b,c,d){a=new Promise(a);SP.request(b,c,a,d?_resolveResult:_setDone,a.setFail);return a},_artists=function(a){return Artist.fromURI(a.uri,a)},_albums=function(a){return Album.fromURI(a.uri,a)},_discs=function(a){return Disc.fromURI(a.uri,a)};function Cache(a){this._items={};this._class=a}Cache.lookup=function(a,b){return this._cache.lookup(a,b)};
Cache.lookupMany=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(this._cache.lookup(a[c]));return b};Cache.prototype.cache=function(a,b){this._items[a]=b};Cache.prototype.lookup=function(a,b){if(!a)return null;var c=this._items[a];c||(c=new this._class(a),c.resolveMany(0,b),this._items[a]=c);return c};Cache.prototype.remove=function(a){delete this._items[a]};Cache.prototype.update=function(a,b){for(var c=0,d=a.length;c<d;c++){var e=this._items[a[c]];e&&e.resolveMany(0,b)}};
function Observable(){}Observable.prototype._observed=function(){};Observable.prototype.addEventListener=function(a,b){if(b){this._ob||(this._ob={},this._obcount=0);var c=this._ob[a];c?c.push(b):this._ob[a]=[b];this._obcount++;1==this._obcount&&this._observed()}};Observable.prototype.removeEventListener=function(a,b){var c=this._ob||{},d=c[a]||[],e=d.indexOf(b);-1!=e&&(this._obcount--,d.splice(e,1),d.length||delete c[a],this._obcount||delete this._ob)};
Observable.prototype.dispatchEvent=function(a){"string"==typeof a&&(a={type:a});if(!a||!a.type)throw Error("Dispatched event must have a type.");a.target||(a.target=this);var b=((this._ob||{})[a.type]||[]).slice(0);if(!b.length)return!0;var c=!0;a.preventDefault=function(){c=!1};for(var d=0;d<b.length;d++)try{!1===b[d].call(this,a)&&(c=!1)}catch(e){if(console.error(e),SP._throwError)throw e;}return c};function Promise(a){this.object=a;this._done=[];this._fail=[]}
Promise.prototype.always=function(a,b){var c,d;b?(c=b,d=a):(c=a,d=this);if("function"!=typeof c)throw Error("A callback function is required");this._done?(this._done.push(SP.callback(SP.bind(c,d))),this._fail.push(SP.callback(SP.bind(c,d)))):c.apply(d,this._args);return this};
Promise.prototype.done=function(a,b){var c,d;b?(c=b,d=a):(c=a,d=this);if("function"!=typeof c)throw Error("A callback function is required");this._isDone?c.apply(d,this._args):this._done&&this._done.push(SP.callback(SP.bind(c,d)));return this};Promise.prototype.fail=function(a,b){var c,d;b?(c=b,d=a):(c=a,d=this);if("function"!=typeof c)throw Error("A callback function is required");this._isFail?c.apply(d,this._args):this._fail&&this._fail.push(SP.callback(SP.bind(c,d)));return this};
Promise.prototype.each=function(a,b){if(this._objs){var c,d;b?(c=b,d=a):(c=a,d=this);if("function"!=typeof c)throw Error("A callback function is required");this._each&&this._each.push(SP.callback(SP.bind(c,d)));for(var e=0,f=this._objs.length;e<f;e++)c.call(d,this._objs[e])}return this};
Promise.prototype.setDone=function(a){if(this._done){var b=this._done,c=this._fail;delete this._done;delete this._fail;1==arguments.length&&(this.object=a);this._isDone=!0;this._args=[this.object];for(var d=0,e=b.length;d<e;d++)b[d].apply(void 0,this._args);b=0;for(d=c.length;b<d;b++)c[b].clear();delete this._each;delete this._join;delete this._numResolved;delete this._oneFailed}};
Promise.prototype.setFail=function(a){if(this._done){var b=this._fail,c=this._done;delete this._done;delete this._fail;this._isFail=!0;this._args=[this.object,a];for(var a=0,d=b.length;a<d;a++)b[a].apply(void 0,this._args);b=0;for(a=c.length;b<a;b++)c[b].clear();delete this._each;delete this._join;delete this._numResolved;delete this._oneFailed}};
Promise.join=function(a){var b=new Promise,a=SP.varargs(arguments,0,!0);b._join=a;b._each=[];b._objs=[];b._numResolved=0;0===a.length&&b.setDone([]);for(var c=0,d=a.length;c<d;c++)a[c].done(b,b._oneDone).fail(b,b._oneFail);return b};
Promise.prototype._oneEither=function(){this._numResolved++;if(!(this._numResolved<this._join.length)){this.object=[];for(var a=0,b=this._join.length;a<b;a++)this.object.push(this._join[a].object);a=0;for(b=this._each.length;a<b;a++)this._each[a].clear();this._oneFailed?this.setFail():this.setDone()}};Promise.prototype._oneDone=function(a){if(this._done){this._objs.push(a);for(var b=[],c=0,d=this._each.length;c<d;c++){var e=this._each[c];b.push(e.copy());e.call(void 0,a)}this._each=b;this._oneEither(a)}};
Promise.prototype._oneFail=function(a){this._done&&(this._oneFailed=!0,this._oneEither(a))};function Loadable(){Observable.call(this)}SP.inherit(Loadable,Observable);Loadable.define=function(a,b,c){a=a.prototype;a._prop||(a._prop={});a._next||(a._next=0);for(var c={mask:0,func:c},d=0,e=b.length;d<e;d++){var f=1<<a._next++;c.mask|=f;a._prop[b[d]]={mask:f,group:c}}};Loadable.prototype._make=function(a,b){var c=this["_make_"+a];return c?c(b):b};
Loadable.prototype.resolve=function(a,b,c){this._prop[a]&&(this._done|=this._prop[a].mask,this._wait&=~this._done,b=this._make(a,b),this.hasOwnProperty(a)&&!c?(c=this[a],c!==b&&(this[a]=b,this.dispatchEvent({type:"change:"+a,property:a,oldValue:c}))):this[a]=b,this._wait||delete this._wait)};Loadable.prototype.resolveMany=function(a,b,c){for(var d in b)this.resolve(d,b[d],c);this._done|=a;this._wait&=~a;this.resolveDone()};
Loadable.prototype.resolveDone=function(){if(this._reqs){for(var a=[],b=0;b<this._reqs.length;b++)this._reqs[b]._need&~this._done||a.push(this._reqs.splice(b--,1)[0]);this._reqs.length||delete this._reqs;this._wait||delete this._wait;for(var b=0,c=a.length;b<c;b++)a[b].setDone()}};
Loadable.prototype.resolveFail=function(a,b){this._wait&=~a;if(this._reqs){for(var c=[],d=0;d<this._reqs.length;d++)this._reqs[d]._need&a&&c.push(this._reqs.splice(d--,1)[0]);this._reqs.length||delete this._reqs;this._wait||delete this._wait;for(var d=0,e=c.length;d<e;d++)c[d].setFail(b)}};
Loadable.prototype.load=function(a){var b=SP.varargs(arguments),c=new Promise(this);c._need=this._neededForLoad(b);c._need?(this._reqs?this._reqs.push(c):this._reqs=[c],this._requestProperties(c._need)):c.setDone();return c};Loadable.prototype._neededForLoad=function(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c],f=this._prop[e];if(!f)throw Error(e+" is not a property.");b|=f.mask}return b&~this._done};
Loadable.prototype._requestProperties=function(a){var b=[],c;for(c in this._prop){var d=this._prop[c],e=d.group.mask;if(e&a&&!(e&this._wait)&&(b.push(d.group),this._wait|=e,a&=~e,!a))break}a=0;for(c=b.length;a<c;a++)(d=this[b[a].func])&&d.call(this,b[a].mask)};function BridgeLoadable(){Loadable.call(this)}SP.inherit(BridgeLoadable,Loadable);BridgeLoadable.prototype.bridgeListen=function(a,b){this._requestName=a;this._requestArgs=b;this._listening=!0;this._eventWait()};
BridgeLoadable.prototype.bridgeUnlisten=function(){delete this._requestName;delete this._requestArgs;delete this._listening};BridgeLoadable.prototype._eventWait=function(){this._listening&&SP.request(this._requestName,this._requestArgs,this,this._eventDone,this._eventFail)};BridgeLoadable.prototype._eventDone=function(a){this._eventWait();this.eventDone(a)};
BridgeLoadable.prototype.eventDone=function(a){if(a.receiver&&this.hasOwnProperty(a.receiver)){var b=this[a.receiver];b.resolveMany(0,a.data);b.dispatchEvent(a)}else this.resolveMany(0,a.data),this.dispatchEvent(a)};BridgeLoadable.prototype._eventFail=function(a){"timeout"==a.error&&this._eventWait();this.eventFail(a)};BridgeLoadable.prototype.eventFail=function(){};function ProxyListener(){BridgeLoadable.call(this);this._filters=[];this._receivers=[]}SP.inherit(ProxyListener,BridgeLoadable);
ProxyListener.prototype.filter=function(a){this._filters.push(a)};ProxyListener.prototype.proxyTo=function(a){this._receivers.push(a)};ProxyListener.prototype.eventDone=function(a){var b,c,d=!0;b=0;for(c=this._filters.length;b<c;b++)!1===this._filters[b](a)&&(d=!1);if(d){b=0;for(c=this._receivers.length;b<c;b++)this._receivers[b].eventDone(a)}};function MdL(){BridgeLoadable.call(this)}SP.inherit(MdL,BridgeLoadable);MdL.init=function(a,b){a._type=b};
MdL.prototype.imageForSize=function(a){for(var b=this.images,a=a*(window.devicePixelRatio||1),c=0,d=b?b.length:0;c<d;c++)if(b[c][0]>=a||c==d-1)return b[c][1].replace("{size}",a);return this.image};MdL.prototype._metadata=function(a){SP.request(this.constructor._type+"_metadata",[this.uri],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};
MdL.prototype._profile=function(a){SP.request(this.constructor._type+"_profile",[this.uri],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};MdL.prototype.toString=function(){return this.uri};function Album(a){MdL.call(this);this.resolve("uri",a)}SP.inherit(Album,MdL);Loadable.define(Album,["uri"]);Loadable.define(Album,"availability artists date discs image images label name playable popularity type".split(" "),"_metadata");Loadable.define(Album,["copyrights"],"_profile");
Loadable.define(Album,["tracks"],"_collections");MdL.init(Album,"album");Album.prototype._make_artists=function(a){return a&&a.map(_artists)};Album.prototype._make_discs=function(a){return a&&a.map(_discs)};Album.prototype._collections=function(){this.resolve("tracks",new BridgeCollection(Track,this.uri,"album_tracks"));this.resolveDone()};Album.fromURI=Cache.lookup;Album.fromURIs=Cache.lookupMany;Album._cache=new Cache(Album);
function Disc(a){MdL.call(this);this.resolve("uri",a);this.resolve("tracks",new BridgeCollection(Track,a,"album_disc_tracks"))}SP.inherit(Disc,MdL);Loadable.define(Disc,["uri","tracks"]);Loadable.define(Disc,["album","number"],"_metadata");MdL.init(Disc,"disc");Disc.prototype._make_album=function(a){return a&&Album.fromURI(a)};Disc.fromURI=Cache.lookup;Disc.fromURIs=Cache.lookupMany;Disc._cache=new Cache(Disc);
function AlbumGroup(a,b){Loadable.call(this);this.resolve("albums",b&&b.albums?b.albums.map(_albums):[])}SP.inherit(AlbumGroup,Loadable);Loadable.define(AlbumGroup,["albums"]);AlbumGroup.fromURI=function(a,b){return new this(a,b)};function Client(){Loadable.call(this)}SP.inherit(Client,Loadable);Loadable.define(Client,["features"],"_features");Client.prototype._features=function(a){SP.request("client_features",[],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};
Client.prototype.showShareUI=function(a,b,c){a=[a.uri||a,b||""];c&&("x"in c&&"y"in c)&&(a.push(c.x),a.push(c.y));return promisedRequest(this,"client_show_share_ui",a)};Client.prototype.showContextUI=function(a,b,c){a=[Array.isArray(a)?SP.uris(a):[a.uri]];b&&("x"in b&&"y"in b)&&(a.push(b.x),a.push(b.y));c&&c.uri&&a.push(c.uri);return promisedRequest(this,"client_show_context_ui",a)};function Application(){BridgeLoadable.call(this)}SP.inherit(Application,BridgeLoadable);
Loadable.define(Application,["arguments","dropped","identifier","name","uri"],"_query");Application.prototype._observed=function(){this.bridgeListen("application_event_wait",[])};Application.prototype._make_dropped=function(a){return a&&a.map(function(a){return fromURI(a)})};Application.prototype._query=function(a){SP.request("application_query",[],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};
Application.prototype.activate=function(){return promisedRequest(this,"application_activate",[this.uri])};Application.prototype.deactivate=function(){return promisedRequest(this,"application_deactivate",[this.uri])};Application.prototype.exit=function(a){return promisedRequest(this,"application_notify_exit",[a||0])};Application.prototype.hideLoadingScreen=function(){SP.request("application_notify_loaded",[])};
Application.prototype.readFile=function(a){var b=new Promise,c=new XMLHttpRequest;c.open("GET",a,!0);c.onreadystatechange=function(){4===c.readyState&&(200!==c.status&&0!==c.status?b.setFail():b.setDone(c.responseText))};c.send(null);return b};Application.prototype.openURI=function(a,b){return promisedRequest(this,"application_open_uri",[a,b||null])};
Application.prototype.openApp=function(a,b){for(var c=SP.varargs(arguments,1),d=["spotify","app",a],e=0,f=c.length;e<f;e++)d.push(encodeURIComponent(c[e]));return this.openURI(d.join(":"))};Application.prototype.setTitle=function(a,b){return promisedRequest(this,"application_set_title",[a,b||""])};Application.prototype.setPreferredSize=function(a,b){var c=new Promise;SP.request("application_set_preferred_size",[a,b],c,c.setDone,c.setFail);return c};
Application.prototype.clientEvent=function(a,b,c,d,e){return promisedRequest(this,"application_client_event",[].slice.call(arguments))};function Artist(a){MdL.call(this);this.resolve("uri",a)}SP.inherit(Artist,MdL);Loadable.define(Artist,["uri"]);Loadable.define(Artist,["image","images","name","popularity"],"_metadata");Loadable.define(Artist,["biography","genres","portraits","years"],"_profile");Loadable.define(Artist,["albums","appearances","related","singles"],"_collections");
Loadable.define(Artist,["user"],"_associatedUser");MdL.init(Artist,"artist");Artist.prototype._collections=function(){this.resolve("albums",new BridgeCollection(AlbumGroup,this.uri,"artist_albums"));this.resolve("appearances",new BridgeCollection(AlbumGroup,this.uri,"artist_appearances"));this.resolve("related",new BridgeCollection(Artist,this.uri,"artist_related_artists"));this.resolve("singles",new BridgeCollection(AlbumGroup,this.uri,"artist_singles"));this.resolveDone()};
Artist.prototype._associatedUser=function(a){SP.request("artist_associated_user",[this.uri],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};Artist.prototype._make_user=function(a){return a&&User.fromURI(a)};Artist.fromURI=Cache.lookup;Artist.fromURIs=Cache.lookupMany;Artist._cache=new Cache(Artist);
function Collection(a,b,c,d,e){Loadable.call(this);this.resolve("type",a);this.resolve("uri",b);this._snapshot=c;this._args=void 0!==d?d:b;this._factory=e||SP.bind(a.fromURI,a)}SP.inherit(Collection,Loadable);Loadable.define(Collection,["type","uri"]);Collection.prototype.snapshot=function(a,b,c){return(new Snapshot(this,a,b,c)).load("length","range")};Collection.prototype.add=function(){throw Error("This method has not been implemented.");};
Collection.prototype.insert=function(){throw Error("This method has not been implemented.");};Collection.prototype.remove=function(){throw Error("This method has not been implemented.");};Collection.prototype.trim=function(){throw Error("This method has not been implemented.");};Collection.prototype.clear=function(){throw Error("This method has not been implemented.");};Collection.prototype.sorted=function(){throw Error("sorting is not implemented");};
function BridgeCollection(a,b,c,d,e){Collection.call(this,a,b,this._requestSnapshot,d,e);this._prefix=c}SP.inherit(BridgeCollection,Collection);BridgeCollection.prototype._requestSnapshot=function(a,b,c,d){var e=new Promise;SP.request(this._prefix+"_snapshot",[a,b,c,d],e,e.setDone,e.setFail);return e};BridgeCollection.prototype.add=function(a){var b=SP.uris(arguments);b.unshift(this._args);return promisedRequest(this,this._prefix+"_append",b)};
BridgeCollection.prototype.clear=function(){return promisedRequest(this,this._prefix+"_clear",[this._args])};BridgeCollection.prototype.insert=function(a,b){var c=[this._args,a.index,a.uri],d=SP.uris(arguments,1);return promisedRequest(this,this._prefix+"_insert",c.concat(d))};BridgeCollection.prototype.remove=function(a){return promisedRequest(this,this._prefix+"_remove",[this._args,a.index,a.uri])};
BridgeCollection.prototype.trim=function(a){return promisedRequest(this,this._prefix+"_trim",[this._args,a.index,a.uri])};function Context(a){Loadable.call(this);this.resolve("uri",a)}SP.inherit(Context,Loadable);Loadable.define(Context,["uri"]);Context.prototype.toString=function(){return this.uri};Context.fromURI=function(a){return new Context(a)};function Group(a){Loadable.call(this);this.resolve("uri",a);this.resolve("contexts",new BridgeCollection(Context,a,"context_group"))}
SP.inherit(Group,Loadable);Loadable.define(Group,["contexts","uri"]);Group.create=function(a){var b=new Promise;SP.request("context_group_create",[a],b,function(a){a=new Group(a.uri);b.setDone(a)},b.setFail);return b};function Player(a){BridgeLoadable.call(this);this.resolve("id",a)}SP.inherit(Player,BridgeLoadable);Loadable.define(Player,"context duration id index playing position repeat shuffle track volume".split(" "),"_query");
Player.prototype._observed=function(){this.bridgeListen("player_event_wait",[this.id])};Player.prototype.eventDone=function(a){Player._superClass.eventDone.call(this,a);this._queryPosition()};Player.prototype._make_context=function(a){return a&&Context.fromURI(a.uri,a)};Player.prototype._make_track=function(a){return a&&Track.fromURI(a.uri,a)};
Player.prototype._query=function(a){SP.request("player_query",[this.id],this,function(b){this.resolveMany(a,b);this._queryPosition()},function(b){this.resolveFail(a,b)})};Player.prototype._queryPosition=function(){if(!this._pq&&this.playing){var a=this;this._pq=setTimeout(function(){SP.request("player_query",[a.id],a,a._progress)},500)}};Player.prototype._progress=function(a){this._pq=null;this.resolve("position",a.position,!0);delete a.position;this.resolveMany(0,a);this._queryPosition()};
Player.prototype.mapTrackIdentifiers=function(a){return promisedRequest(this,"player_map_track_identifiers",[this.id,a])};Player.prototype.setVolume=function(a){return promisedRequest(this,"player_set_volume",[this.id,a])};Player.prototype.setRepeat=function(a){return promisedRequest(this,"player_set_repeat",[this.id,a])};Player.prototype.setShuffle=function(a){return promisedRequest(this,"player_set_shuffle",[this.id,a])};
Player.prototype.play=function(){return promisedRequest(this,"player_play",[this.id])};Player.prototype.pause=function(){return promisedRequest(this,"player_pause",[this.id])};Player.prototype.stop=function(){return promisedRequest(this,"player_stop",[this.id])};Player.prototype.playTrack=function(a,b,c){return promisedRequest(this,"player_play_track",[this.id,a.uri,b||0,void 0!=c?c:-1])};
Player.prototype.playContext=function(a,b,c,d){null==b&&(b=-1);return promisedRequest(this,"player_play_context",[this.id,a.uri,b,c||0,void 0!=d?d:-1])};Player.prototype.playContextGroup=function(a,b,c,d){void 0==b&&(b=-1);void 0==c&&(c=-1);return promisedRequest(this,"player_play_context_group",[this.id,a.uri,b,c,d||0])};Player.prototype.skipToPrevTrack=function(){return promisedRequest(this,"player_skip_to_prev",[this.id])};
Player.prototype.skipToNextTrack=function(){return promisedRequest(this,"player_skip_to_next",[this.id])};Player.prototype.seek=function(a){return promisedRequest(this,"player_seek",[this.id,a])};function Playlist(a){MdL.call(this);this.resolve("uri",a)}SP.inherit(Playlist,MdL);Loadable.define(Playlist,["uri"]);Loadable.define(Playlist,"allows collaborative description subscribed name owner published".split(" "),"_metadata");Loadable.define(Playlist,["image","images"],"_profile");
Loadable.define(Playlist,["subscribers","tracks"],"_collections");Loadable.define(Playlist,["popularity"],"_popularity");MdL.init(Playlist,"playlist");Playlist.prototype._make_owner=function(a){return a&&User.fromURI(a.uri,a)};Playlist.prototype._collections=function(){this.resolve("subscribers",new BridgeCollection(User,this.uri,"playlist_subscribers"));this.resolve("tracks",new BridgeCollection(Track,this.uri,"playlist_tracks"));this.resolveDone()};
Playlist.prototype._popularity=function(a){SP.request("playlist_popularity",[this.uri],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};Playlist._libraryListener=null;Playlist.fromURI=Cache.lookup;Playlist.fromURIs=Cache.lookupMany;Playlist._cache=new Cache(Playlist);
Playlist.createTemporary=function(a){var b=new Promise;SP.request("playlist_create_temporary",[a],b,function(c){var d=new Playlist(c.uri);Playlist._cache.cache(c.uri,d);d.resolve("name",a);b.setDone(d)},b.setFail);return b};Playlist.removeTemporary=function(a){var b=new Promise;SP.request("playlist_remove_temporary",[a.name],b,function(){Playlist._cache.remove(a.uri);b.setDone()},b.setFail);return b};
Playlist.create=function(a){var b=new Promise;SP.request("playlist_create",[a],b,function(c){var d=new Playlist(c.uri);Playlist._cache.cache(c.uri,d);d.resolve("name",a);b.setDone(d)},b.setFail);return b};
Playlist.getOrCreateLibraryListener=function(){var a=Playlist._libraryListener;a||(a=new ProxyListener,a.bridgeListen("library_event_wait",[exports.session.user.uri]),a.filter(function(a){if(!("insert"!=a.type&&"remove"!=a.type)){var c="insert"==a.type;switch(a.receiver){case "playlists":Playlist._cache.update(a.uris,{subscribed:c});break;case "published":Playlist._cache.update(a.uris,{published:c})}}}),Playlist._libraryListener=a);return a};
Playlist.prototype.load=function(){var a=SP.varargs(arguments);0<=Array.prototype.indexOf.call(a,"subscribed")&&Playlist.getOrCreateLibraryListener();return Playlist._superClass.load.apply(this,a)};Playlist.prototype._observed=function(){this.bridgeListen("playlist_event_wait",[this.uri])};Playlist.prototype.eventFail=function(a){this._obcount||this.bridgeUnlisten();Playlist._superClass.eventFail.call(this,a)};
Playlist.prototype.setDescription=function(a){return promisedRequest(this,"playlist_set_description",[this.uri,a],!0)};Playlist.prototype.setImage=function(a){return promisedRequest(this,"playlist_set_image",[this.uri,a],!0)};Playlist.prototype.setName=function(a){return promisedRequest(this,"playlist_set_name",[this.uri,a],!0)};Playlist.prototype.setSource=function(a,b){return promisedRequest(this,"playlist_set_source",[this.uri,a,b])};
Playlist.prototype.enforceRules=function(a){return promisedRequest(this,"playlist_enforce_rules",[this.uri,a])};function Profile(a){MdL.call(this);this.resolve("uri",a)}SP.inherit(Profile,MdL);Profile.fromURI=Cache.lookup;Profile._cache=new Cache(Profile);Loadable.define(Profile,["uri"]);Loadable.define(Profile,["artist","user"],"_loadArtistOrUser");Loadable.define(Profile,["name","image","images"],"_metadata");Profile.prototype._make_artist=function(a){return Artist.fromURI(a)};
Profile.prototype._make_user=function(a){return User.fromURI(a)};Profile.prototype._loadArtistOrUser=function(a){var b=exports.fromURI(this.uri),c;if(b instanceof Artist)c=b.load("user").done(this,function(){this.resolveMany(a,{artist:b.uri,user:b.user.uri})});else if(b instanceof User)c=b.load("artist").done(this,function(){this.resolveMany(a,{artist:b.artist.uri,user:b.uri})});else throw Error("Invalid URI for Profile");c.fail(this,function(){this.resolveFail(a,{message:"Failed to resolve artist/user objects"})})};
Profile.prototype._metadata=function(a){this.load("artist","user").done(this,function(){this.user?(this.artist?Promise.join(this.artist.load("name"),this.user.load("image","images")):this.user.load("name","image","images")).done(this,function(){var b={name:this.artist?this.artist.name:this.user.name,image:null,images:null};!this.user.image&&this.artist?this.artist.load("image","images").done(function(a){b.image=a.image;b.images=a.images}).always(this,function(){this.resolveMany(a,b)}):(b.image=this.user.image,
b.images=this.user.images,this.resolveMany(a,b))}).fail(this,function(b,c){this.resolveFail(a,c)}):this.artist.load("name","image","images").done(this,function(b){this.resolveMany(a,{name:b.name,image:b.image,images:b.images})}).fail(this,function(b,c){this.resolveFail(a,c)})})};function Reference(a,b){this.index=a;this.uri=b}function Session(){BridgeLoadable.call(this);this.resolve("user",User.fromURI("spotify:user:@"))}SP.inherit(Session,BridgeLoadable);Loadable.define(Session,["user"]);
Loadable.define(Session,"connecting connection country developer device incognito language online partner product resolution streaming testGroup capabilities".split(" "),"_query");Session.prototype._observed=function(){this.bridgeListen("session_event_wait",[])};Session.prototype._query=function(a){SP.request("session_query",[],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};
function Snapshot(a,b,c,d){Loadable.call(this);this._collection=a;this._off=void 0===b?0:b;this._len=void 0===c?-1:c;this._raw=!!d}SP.inherit(Snapshot,Loadable);Loadable.define(Snapshot,["length","range"],"_request");
Snapshot.prototype._request=function(){var a=this._collection;a._snapshot(a._args,this._off,this._len,this._raw).done(this,function(a){this._uris=a.array;this._meta=a.metadata||[];this.resolve("length",a.length);this.resolve("range",{offset:this._off,length:this._uris.length});this.resolveDone()}).fail(this,function(a){var c=this._neededForLoad(["length","range"]);this.resolveFail(c,a)})};
Snapshot.prototype.get=function(a){a instanceof Reference&&(a=a.index);a-=this._off;return 0>a||a>this._uris.length?null:this._collection._factory(this._uris[a],this._meta[a])};Snapshot.prototype.find=function(a,b){b instanceof Reference&&(b=b.index);var c=this._uris.indexOf(a.uri,b||0);return-1==c?null:new Reference(c+this._off,this._uris[c])};Snapshot.prototype.loadAll=function(){for(var a=[],b=this.toArray(),c=0,d=b.length;c<d;c++){var e=b[c];a.push(e.load.apply(e,arguments))}return Promise.join(a)};
Snapshot.prototype.ref=function(a){var b=this.get(a);return new Reference(a,b?b.uri:null)};Snapshot.prototype.toArray=function(){for(var a=[],b=this._collection,c=0,d=this._uris.length;c<d;c++)a[c]=b._factory(this._uris[c],this._meta[c]);return a};Snapshot.prototype.toURIs=function(){return this._uris.slice()};function Track(a){MdL.call(this);this.resolve("uri",a)}SP.inherit(Track,MdL);Loadable.define(Track,["uri"]);
Loadable.define(Track,"advertisement album artists availability disc duration explicit image images local name number placeholder playable popularity starred".split(" "),"_metadata");MdL.init(Track,"track");Track.prototype._make_album=function(a){return a&&Album.fromURI(a.uri,a)};Track.prototype._make_artists=function(a){return a&&a.map(_artists)};Track.fromURI=Cache.lookup;Track.fromURIs=Cache.lookupMany;Track._cache=new Cache(Track);
Track.prototype.star=function(){return promisedRequest(this,"library_star",[exports.session.user.uri,this.uri])};Track.prototype.unstar=function(){return promisedRequest(this,"library_unstar",[exports.session.user.uri,this.uri])};Track._trackEventWait=function(){SP.request("track_event_wait_any",[],this,this._trackEventDone,this._trackEventFail)};Track._trackEventDone=function(a){var b=Track.fromURI(a.data.uri);b.resolveMany(0,a.data);b.dispatchEvent(a);this._trackEventWait()};
Track._trackEventFail=function(a){"timeout"==a.error&&this._trackEventWait()};function User(a){MdL.call(this);this.resolve("uri",a)}SP.inherit(User,MdL);Loadable.define(User,["uri"]);Loadable.define(User,"currentUser identifier image images name subscribed username".split(" "),"_metadata");Loadable.define(User,["artist"],"_associatedArtist");MdL.init(User,"user");
User.prototype._associatedArtist=function(a){SP.request("user_associated_artist",[this.uri],this,function(b){this.resolveMany(a,b)},function(b){this.resolveFail(a,b)})};User.prototype._make_artist=function(a){return a&&Artist.fromURI(a)};User._relationsListener=null;User.fromURI=Cache.lookup;User.fromURIs=Cache.lookupMany;User._cache=new Cache(User);
User.fromUsername=function(a){for(var a=encodeURIComponent(a),b=-1;-1<(b=a.indexOf("%",b+1));)a=a.substring(0,b+1)+a.substring(b+1,b+3).toLowerCase()+a.substring(b+3);return User.fromURI("spotify:user:"+a)};
User.getOrCreateRelationsListener=function(){var a=User._relationsListener;a||(a=new ProxyListener,a.bridgeListen("relations_event_wait",[exports.session.user.uri]),a.filter(function(a){"subscriptions"!=a.receiver||"add"!=a.type&&"remove"!=a.type||User._cache.update(a.uris,{subscribed:"add"==a.type})}),User._relationsListener=a);return a};
User.prototype.load=function(){var a=SP.varargs(arguments);0<=Array.prototype.indexOf.call(a,"subscribed")&&User.getOrCreateRelationsListener();return User._superClass.load.apply(this,a)};var fromURI=function(a,b){var c=a.split(":");switch(c[1]){case "album":return 4==c.length?Disc.fromURI(a,b):Album.fromURI(a,b);case "artist":return Artist.fromURI(a,b);case "track":return Track.fromURI(a,b);case "user":return 3<c.length&&"facebook"!=c[2]?Playlist.fromURI(a,b):User.fromURI(a,b)}return null};Track._trackEventWait();
exports.Observable=Observable;exports.Loadable=Loadable;exports.BridgeLoadable=BridgeLoadable;exports.MdL=MdL;exports.Album=Album;exports.Application=Application;exports.Artist=Artist;exports.Cache=Cache;exports.Client=Client;exports.Collection=Collection;exports.BridgeCollection=BridgeCollection;exports.Context=Context;exports.Disc=Disc;exports.Group=Group;exports.Player=Player;exports.Playlist=Playlist;exports.Profile=Profile;exports.Promise=Promise;exports.Session=Session;exports.Track=Track;
exports.User=User;exports.application=new Application;exports.client=new Client;exports.fromURI=fromURI;exports.player=new Player("main");exports.preview=new Player("preview");exports.promisedRequest=promisedRequest;exports.session=new Session;
