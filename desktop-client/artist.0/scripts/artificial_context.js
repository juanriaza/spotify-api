require(["$api/models"],function(d){function c(){}c.prototype.append=function(b,c){a.append(b,c)};var a=c;c.init=function(){c.contexts=[];c.index={};c.isShuffle=null;c.isRepeat=null;c.playingContext=null;c._ref=0;c.isActive=!0;d.player.load("repeat","shuffle").done(a.propertiesLoaded);d.player.addEventListener("change",a.playerChange);d.application.addEventListener("activate",a.onActivationStateChanged);d.application.addEventListener("deactivate",a.onActivationStateChanged)};c.onActivationStateChanged=
function(b){a.isActive=b.data.active};c.pushContextGroup=function(){var b=[];a.contexts.push(b);a.currentGroupIndex=a.contexts.length-1;a.currentContextGroup=b};c.append=function(b,c){var d=a._ref;a._ref++;a.currentContextGroup.push({uri:b,length:c,songsLeft:c,_ref:d});a.index[b]={group:a.currentGroupIndex,index:a.currentContextGroup.length-1,_ref:d}};c.runNext=function(){var b=a.index[a.playingContext];if(void 0!==b){var c=a.contexts[b.group],b=b.index+1;b<c.length&&(c=a.contextFromURI(c[b].uri),
null!==c&&d.player.playContext(c))}};c.collectContexts=function(){var b=a.index[a.playingContext];if(void 0!==b&&b.group===a.contexts.length-1&&0<b.group){var b=b.group,c=a.contexts.slice(b),d={},e;for(e in a.index)a.index.hasOwnProperty(e)&&(a.index[e].group-=b,0<=a.index[e].group&&(d[e]=a.index[e]));delete a.index;delete a.contexts;a.index=d;a.contexts=c}};c.printGroups=function(){for(var b in a.index)a.index.hasOwnProperty(b)&&(console.log("key:",a.index[b],"ref:",a.index[b].ref,"group:",a.index[b].group,
"idx:",a.index[b].index),console.log("resolves to: ",a.contexts[a.index[b].group][a.index[b].index].uri))};c.contextFromURI=function(a){return 0==a.indexOf("spotify:album:")?d.Album.fromURI(a):0==a.indexOf("spotify:playlist:")||0==a.indexOf("spotify:internal:temp_playlist:")?d.Playlist.fromURI(a):null};c.propertiesLoaded=function(a){c.isShuffle=a.shuffle;c.isRepeat=a.repeat};c.playerChange=function(b){a.isShuffle=b.data.shuffle;a.isRepeat=b.data.repeat;void 0===b.data.context&&void 0===b.data.track?
a.runNext():void 0!==b.data.context&&(a.playingContext=b.data.context.uri);window.setTimeout(a.collectContexts,0)};exports.ArtificialContext=c});
