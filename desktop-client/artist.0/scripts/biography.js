require(["/scripts/env#Environment","/strings/main.lang"],function(n,e){function d(){this.view=new d.view;this.noBio=this.imagesLoaded=this.loaded=!1;this.specialCases={"spotify:artist:0du5cEVh5yTK9QJze8zA0C":200}}function c(){}var g=e.get.bind(e);d.view=c;d.prototype.init=function(a){this.artist=a;this.view.init();a=this.artist?this.artist.biography:"";return(this.noBio=void 0===a||0===a.length)?(this.view.hide(),!1):!0};d.prototype.destroy=function(){this.noBio=this.imagesLoaded=this.loaded=!1;
this.view.destroy()};d.prototype.render=function(){this.loaded=!0;if(!this.noBio){var a=this.artist.biography;this.view.show();var b;this.specialCases[this.artist.uri]?b=a.substring(0,this.specialCases[this.artist.uri]):(b=this.artist.name.split("."),0===b.length?b=a.match(/((?:.*?)\.\s[A-Z])/)[0]:(b=b.slice(1,b.length).join("."),b=b.replace(".","\\."),b=b.replace(" ","\\s"),b=a.match(RegExp("((?:.*?)(?:"+b+")(?:.*?)\\.\\s[A-Z])"))[0]),b=b.substr(0,b.length-2));a=a.replace(b,this.view.makeIntro(b));
a.split("\n").forEach(this.view.addParagraph.bind(this.view));this.view.renderText(this.artist)}};d.prototype.renderImages=function(){this.imagesLoaded=!0;this.view.renderImages(this.artist)};c.IMAGE_HEIGHT=138;c.IMAGE_PADDING=22;c.PAGE_WIDTH=600;c.CONTENT_CONTAINER=$("biography-text");c.GALLERY_CONTAINER=$("biography-gallery");c.prototype.init=function(){this._bio="";this._imagesInjected=!1};c.prototype.destroy=function(){this._bio="";$("biography-gallery").empty();$("biography-text").empty();this._imagesInjected=
!1};c.prototype.show=function(){$$("li.biography").setStyle("display","inline-block")};c.prototype.hide=function(){$$("li.biography").setStyle("display","none")};c.prototype.makeIntro=function(a){return'<p class="intro">'+a+"</p>"};c.prototype.addParagraph=function(a){this._bio+="<p>"+a+"</p>"};c.prototype.renderText=function(){c.CONTENT_CONTAINER.innerHTML=this._bio;this._highlightLinks()};c.prototype.renderImages=function(a){if(1<a.portraits.length)for(var b=new Element("ul",{id:"biography-images",
"class":"cf"}),d=new Element("li"),e=new Element("img",{"class":"biography-image"}),f=0,h=0,i=this,g=function(){h+=1;f+=Math.floor(c.IMAGE_HEIGHT/this.height*this.width)+c.IMAGE_PADDING;if(!1===i._imagesInjected&&(f>c.PAGE_WIDTH||h===a.portraits.length-1))i._imagesInjected=!0,i.injectImages(c.GALLERY_CONTAINER,b,f)},j=1,p=a.portraits.length;j<p;j++){var k=e.clone(),m=d.clone(),l=a.portraits[j];n.web&&(l=l.replace("300","artist_image"));k.setProperty("src",l);k.inject(m);m.inject(b);k.addEvent("load",
g)}};c.prototype.injectImages=function(a,b,d){b.inject(a,"top");d>c.PAGE_WIDTH&&(a=new Element("p",{id:"biography-toggle",html:g("see-more")}),a.addEvent("click",function(){b.removeClass("closed");b.addClass("open");b.addClass("animation");this.dispose()}),b.addClass("closed"),a.inject(b,"after"))};c.prototype._highlightLinks=function(){c.CONTENT_CONTAINER.getElements("a").forEach(function(a){a.href.match(/spotify:/)&&(a.href=a.href.toSpotifyURL())})};exports.Biography=d});
