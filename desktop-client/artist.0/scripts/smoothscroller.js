require(["/scripts/utils"],function(n){function d(){this.scrollDebounceMs=300;this.items={};this.dirty=[];this.itemYPositions=[];this.scrollBufferSize=2E3;this.scrollHandle=this.scrollHandler.bind(this);this.updateFn=this.updateOnScroll.bind(this);this.scrollScheduled=!1;window.addEventListener("scroll",this.scrollHandle);window.addEventListener("resize",this.scrollHandle);this.updateViewport()}function f(a,c,b,j){this.parent=b;this.scroller=a;this.wrapper=(new Element("div",{"class":"smoothscroller-item"})).grab(c);
this.callback=j;this.callbackFired=!1;this.el=c;this.bottom=this.top=this.height=0;this.destroyed=!1}var m=0,k=0;d.prototype.scrollHandler=function(){this.scrollScheduled||(setTimeout(this.updateFn,this.scrollDebounceMs),this.scrollScheduled=!0)};d.prototype.updateOnScroll=function(){this.updateViewport();this.updateItems(!1);this.scrollScheduled=!1};d.prototype.updateViewport=function(){var a=n.scrollPosition().y;m=a;k=window.innerHeight+a};d.prototype.updateItems=function(a){this.updateViewport();
for(var c=this.findItem(Math.max(0,m-this.scrollBufferSize)),b=this.findItem(k+this.scrollBufferSize),j=c[0],e=b[1],c=a?0:Math.max(0,c[2]),a=a?this.itemYPositions.length:Math.min(b[3]+1,this.itemYPositions.length),b=0,d=this.dirty.length;b<d;b++){var g=this.itemYPositions[this.dirty[b]];if(g)for(var f=this.items[g].length,l=this.items[g],h=0;h<f;h++){var i=l[h];i.hide()}}this.dirty=[];for(b=c;b<a;b++){g=this.itemYPositions[b];f=this.items[g].length;l=this.items[g];for(h=0;h<f;h++)i=l[h],g<j-this.scrollBufferSize||
g>e+this.scrollBufferSize?i.hide()&&this.dirty.push(b):i.show()&&this.dirty.push(b)}};d.prototype.map=function(a){for(var c=this.itemYPositions.length,b=0;b<c;b++)for(var d=this.itemYPositions[b],e=this.items[d].length,f=this.items[d],g=0;g<e;g++)a(d,f[g])};d.prototype.append=function(a,c,b,d,e){a=new f(this,a,c,d);e&&(a.group=e);c.appendChild(a.wrapper);b&&("number"===typeof b&&Math.floor(b)==b)&&a.setHeight(b);a.cacheCords();this.items[a.top]||(this.items[a.top]=[]);this.items[a.top].push(a);c=
this.itemYPositions.indexOf(a.top);-1===c&&(this.itemYPositions.push(a.top),c=this.itemYPositions.length-1);a.top>k+this.scrollBufferSize?a.hide():a.show();this.dirty.push(c);return a};d.prototype.recalculateAllItems=function(a){var c={},b=[];this.map(function(d,e){e.destroyed||(a?a>=e.top&&e.cacheCords():e.cacheCords(),c[e.top]||(c[e.top]=[]),c[e.top].push(e),~b.indexOf(e.top)||b.push(e.top))});this.items=c;this.itemYPositions=b;this.updateItems(!0)};d.prototype.findItem=function(a){for(var c=0,
b=this.itemYPositions.length-1,d=0;1<b-c;){d++;var e=Math.round((c+b)/2);this.itemYPositions[e]<=a?c=e:b=e}this.itemYPositions[c]===a&&(b=c);return[this.itemYPositions[c],this.itemYPositions[b],c,b]};d.prototype.destroy=function(){window.removeEventListener("scroll",this.scrollHandle);window.removeEventListener("resize",this.scrollHandle)};f.prototype.detach=function(){this.destroyed=!0};f.prototype.hide=function(){return"none"!==this.el.style.display?(this.el.style.display="none",!0):!1};f.prototype.show=
function(){if("block"!==this.el.style.display){if(!this.callbackFired){var a=this.wrapper.getAttribute("class");this.wrapper.setAttribute("class",a+" ssc-ready");this.callbackFired=!0;this.callback.call(this)}this.el.style.display="block";return!0}return!1};f.prototype.cacheCords=function(){this.top=this.wrapper.getPosition().y;this.height=this.wrapper.offsetHeight;this.bottom=this.top+this.height;this.wrapper.style.height=this.height+"px"};f.prototype.setHeight=function(a){this.wrapper.style.height=
a+"px"};f.prototype.modifyHeight=function(a){this.setHeight(this.height+a);this.scroller.recalculateAllItems(this.top)};exports.SmoothScroller=d});
