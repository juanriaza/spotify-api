var sp=getSpotifyApi(),language=sp.require("$util/language"),models=sp.require("$api/models"),views=sp.require("$api/views"),loggingHelper,testGroup;exports.MiniPlayer=MiniPlayer;exports.setLoggingHelper=setLoggingHelper;
function MiniPlayer(){function b(b){b.data.playstate&&(sp.trackPlayer.getIsPlaying()&&a.isCurrentlyPlaying()?a.play(!1):a.pause(!1))}var a=this;a.resource=null;a.node=document.createElement("div");a.playing=!1;a.button=document.createElement("a");a.node.className="player paused";a.node.addEventListener("DOMNodeInsertedIntoDocument",function(){sp.trackPlayer.addEventListener("playerStateChanged",b)});a.node.addEventListener("DOMNodeRemovedFromDocument",function(){sp.trackPlayer.removeEventListener("playerStateChanged",
b)});a.button.addEventListener("click",function(b){b.preventDefault();a.toggle(!0)});a.button.classList.add("play");a.node.appendChild(a.button)}MiniPlayer.prototype.toggle=function(b){return!0===this.playing?this.pause(b):this.play(b)};function triggerPlayerEvent(b,a){var c=document.createEvent("Event");c.initEvent("playstatechange",!0,!0);c.playing=a;c.resource=b.resource;return b.node.dispatchEvent(c)}
MiniPlayer.prototype.play=function(b){if(b&&!triggerPlayerEvent(this,!0))return this;var a=this;a.playing=!0;a.node.classList.remove("paused");if(!1===b)return a;a.onSameSong()?sp.trackPlayer.setIsPlaying(a.playing):(loggingHelper.logClientEvent("feed player played","play",this.resource.data),sp.trackPlayer.playTrackFromUri(a.resource.uri,{onSuccess:id,onFailure:function(){a.pause()}}));return a};
MiniPlayer.prototype.pause=function(b){if(b&&!triggerPlayerEvent(this,!1))return this;this.playing=!1;this.node.classList.add("paused");!0===b&&(loggingHelper.logClientEvent("feed player paused","pause",this.resource.data),sp.trackPlayer.setIsPlaying(this.playing));return this};MiniPlayer.prototype.loadURI=function(b){var a=sp.core.getLinkType(b);models.Link.TYPE.TRACK===a&&(models.Track.fromURI(b,partial(playTrack,this)),this.isCurrentlyPlaying()&&this.play(!1));this.button.href=b};
function playTrack(b,a){b.resource=a;b.button.title=b.resource.name.decodeForText();return a}MiniPlayer.prototype.isCurrentlyPlaying=function(){return sp.trackPlayer.getIsPlaying()&&this.onSameSong()};MiniPlayer.prototype.onSameSong=function(){var b=sp.trackPlayer.getNowPlayingTrack(),a=sp.trackPlayer.getPlayingContext(),c;if(null===this.resource||null===b)return!1;c=this.resource.uri;return c===b.track.uri||a.length&&a[0]===c?!0:!1};
function setLoggingHelper(b){loggingHelper=b;testGroup=loggingHelper.getTestGroup()};
