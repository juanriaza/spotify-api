exports.getRecommendations=getRecommendations;exports.getTopPlaylists=getTopPlaylists;var sp=getSpotifyApi(),models=sp.require("$api/models");
sp.core.registerSchema([{name:"SuggestionRequest",fields:[{id:1,type:"int32",name:"count"},{id:3,type:"*int32",name:"reasons"}]},{name:"Reason",fields:[{id:1,type:"int32",name:"why"},{id:2,type:"*string",name:"uris"}]},{name:"UserSuggestion",fields:[{id:1,type:"string",name:"username"},{id:2,type:"*Reason",name:"reasons"},{id:3,type:"int32",name:"subscriberCount"}]},{name:"UserSuggestionReply",fields:[{id:1,type:"*UserSuggestion",name:"suggestions"}]},{name:"TopPlaylists",fields:[{id:1,type:"string",
name:"username"},{id:2,type:"int32",name:"count"}]},{name:"TopPlaylistsReply",fields:[{id:1,type:"*string",name:"uris"}]}]);var ReasonType={OTHER:0,SUBSCRIPTION_OF_SUBSCRIPTION:1,MY_SUBSCRIBER:2,SIMILAR_TASTE:3,FACEBOOK:4,EDITORIAL:5};exports.ReasonType=ReasonType;var RECOMMENDATION_BATCH_SIZE=120;exports.RECOMMENDATION_BATCH_SIZE=RECOMMENDATION_BATCH_SIZE;
function getRecommendations(b,f,c){sp.core.getHermes("GET","hm://socialgraph/suggestions/people",[["SuggestionRequest",{count:RECOMMENDATION_BATCH_SIZE,reasons:b}]],{onSuccess:function(a){var g=[],a=sp.core.parseHermesReply("UserSuggestionReply",a);a.suggestions&&(a.suggestions.forEach(function(a){var d=ReasonType.OTHER,c=[],e=!1,h=!1,b=!1;a.reasons.forEach(function(a){switch(a.why){case ReasonType.EDITORIAL:e=!0;break;case ReasonType.FACEBOOK:h=!0;break;case ReasonType.MY_SUBSCRIBER:case ReasonType.SUBSCRIPTION_OF_SUBSCRIPTION:b=
!0}d!==ReasonType.SUBSCRIPTION_OF_SUBSCRIPTION&&(d=a.why,c=a.uris?a.uris:[])});a=new models.User({canonicalUsername:a.username,subscriberCount:a.subscriberCount});a.loaded=!1;g.push({user:a,reason:d,seeds:c,isFeatured:e,isFacebook:h,isRecommended:b})}),f(g))},onFailure:c})}
function getTopPlaylists(b,f,c){sp.core.getHermes("GET","hm://socialgraph/suggestions/topplaylists/",[["TopPlaylists",{username:b,count:5}]],{onSuccess:function(a){a=sp.core.parseHermesReply("TopPlaylistsReply",a);if(a.uris)for(var b=0,i=a.uris.length,d=[],j=0,e=function(a){d.push(a);0>=--j&&f(d)};b<i;b++)models.Playlist.fromURI(a.uris[b],e);else c()},onFailure:c})};
