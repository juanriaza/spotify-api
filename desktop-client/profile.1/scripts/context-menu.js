require(["scripts/profile-utils","$views/popup#Popup","$views/utils/css","$shared/events#EventHandler"],function(c,f,d,e){c=function(a){a&&this.init(a)};c.prototype.settings=null;c.prototype.element=null;c.prototype.init=function(a){this.events=new e(this);this.settings=a};c.prototype.render=function(){var a=document.createElement("a");d.addClass(a,"context-menu-item");this.settings.hasOwnProperty("cssClass")&&d.addClass(a,this.settings.cssClass);this.settings.hasOwnProperty("active")&&!0===this.settings.active&&
d.addClass(a,"active");a.innerHTML=this.settings.text;this.element=a;this.setEvents()};c.prototype.setEvents=function(){this.settings.hasOwnProperty("handler")&&this.events.listen(this.element,"click",this.runHandler)};c.prototype.runHandler=function(){var a=this;d.addClass(this.element,"success");var b=setTimeout(function(){d.removeClass(a.element,"success");a.settings.handler.call(a);clearTimeout(b)},200)};c.prototype.getNode=function(){this.render();return this.element};c.prototype.dispose=function(){this.events.removeAll()};
var b=function(a){this.events=a||new e(this);this.elems={relative:null,menu:null};this.options=[];this.visible=!1};b.prototype.setPlaylist=function(a){this.playlist=a};b.prototype.setElements=function(a){a&&(this.elems.relative=a)};b.prototype.setUser=function(a){this.user=a};b.prototype.showMenu=function(){this.popup.showFor(this.elems.relative);this.visible=!0;this.setFocus()};b.prototype.buildMenu=function(){var a=0,b=this.options.length;this.elems.menu=document.createElement("div");for(this.elems.menu.setAttribute("tabindex",
0);a<b;a++)this.elems.menu.appendChild(this.options[a].getNode());this.popup=f.withContent(this.elems.menu,125,50,"context-menu");this.showMenu()};b.prototype.clearActive=function(){d.removeClass(this.popup.content.querySelector(".active"),"active")};b.prototype.hideMenu=function(){this.visible=!1;this.popup.hide()};b.prototype.setFocus=function(){this.popup.content.focus();this.events.listen(this.popup.content,"blur",this.close)};b.prototype.close=function(){this.hideMenu();this.events.unlisten(this.popup.content,
"blur",this.close)};b.prototype.renderOptions=function(){this.buildMenu()};b.prototype.setOptions=function(a){this.options=a};b.prototype.show=function(){!this.popup||!this.elems.relative?this.renderOptions():this.showMenu()};b.prototype.toggle=function(){this.visible?this.hideMenu():this.show()};exports.ContextMenu=b;exports.ContextMenuItem=c});
