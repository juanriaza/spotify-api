function Mutex(){this._queue=[]}Mutex.prototype.acquire=function(c){this._queue.push(c);1==this._queue.length&&c()};Mutex.prototype.release=function(){this._queue.shift();this._queue.length&&setTimeout(this._queue[0],0)};exports.Mutex=Mutex;var promise=sp.require("$util/promise");
function SPImage(c,f,n){var a=this;f?(a.node=document.createElement("a"),a.node.href=f,a.node.style.display="none"):a.node=document.createElement("div");n&&(a.node.title=n);a.node.classList.add("image");if(0==c.indexOf("spotify:mosaic:")){var k=[],f=map(function(a){return"spotify:image:"+a},c.slice(15).split(/[,;:]/)),p=new promise.Promise;a.node.addEventListener("DOMNodeInserted",function r(){a.node.style.display="block";p.resolve();a.node.removeEventListener("DOMNodeInserted",r)});k.push(p);f.forEach(function(a){var b=
new Image,d=new promise.Promise;b.src=a;b.complete?d.resolve(b):(b.addEventListener("load",function s(){d.resolve(b);b.removeEventListener("load",s)}),b.addEventListener("error",function h(){d.reject(b);b.removeEventListener("error",h)}));k.push(d)});promise.join.apply(promise,k).always(function(){var c=2*a.node.offsetWidth||300,b=2*a.node.offsetHeight||300,d=Math.floor(Math.sqrt(arguments.length)),f=~~(1E6*Math.random()),g=document.getCSSCanvasContext("2d","cover-"+f,c,b);g.clearRect(0,0,c,b);for(var h=
c/b,i=0;i<arguments.length&&i<d*d;i++){var e=arguments[i],j=e.width/e.height,q,l,m,k=i%d*c/d,n=Math.floor(i/d)*b/d,p=c/d,t=b/d;j===h?(j=q=0,l=e.width,m=e.height):j>h?(q=0,m=e.height,l=h*e.height,j=(e.width-l)/2):(j=0,l=e.width,m=e.width/h,q=(e.height-m)/2);g.drawImage(e,j,q,l,m,k,n,p,t)}a.node.style.backgroundImage="-webkit-canvas(cover-"+f+")"})}else if(c.length){var g=new Image;g.src=c;g.complete?(a.node.style.backgroundImage='url("'+c+'")',a.node.style.display="block"):g.addEventListener("load",
function b(){a.node.style.backgroundImage='url("'+c+'")';a.node.style.display="block";g.removeEventListener("load",b)})}}exports.SPImage=SPImage;
