var sp=getSpotifyApi(),models=sp.require("$api/models"),react=sp.require("$util/react"),social=sp.require("$unstable/social"),FAVORITES_LOADED_EVENT="favoritesLoadedEvent",FAVORITES_CHANGED_EVENT="favoritesChangedEvent";exports.addEventListener=addEventListener;exports.removeEventListener=removeEventListener;exports.addFavoriteUser=addFavoriteUser;exports.getFavoriteUsers=getFavoriteUsers;exports.isFavoriteUser=isFavoriteUser;exports.removeFavoriteUser=removeFavoriteUser;
exports.toggleFavoriteUser=toggleFavoriteUser;exports.FAVORITES_LOADED_EVENT=FAVORITES_LOADED_EVENT;exports.FAVORITES_CHANGED_EVENT=FAVORITES_CHANGED_EVENT;Object.defineProperty(exports,"loaded",{get:isLoaded});var favorites=sp.social.getFavorites(),favoritesChangedEvent=react.fromDOMEvent(favorites,"change"),relationsLoadedEvent=react.fromDOMEvent(social,social.RELATIONS_LOADED_EVENT),relationsChangedEvent=react.fromDOMEvent(social,social.RELATIONS_CHANGED_EVENT),loaded=isLoaded();
react.merge(favoritesChangedEvent,relationsLoadedEvent,relationsChangedEvent).subscribe(function(){notifyListeners()});function addEventListener(a,b,c){if(a!==FAVORITES_CHANGED_EVENT&&a!==FAVORITES_LOADED_EVENT)throw"Invalid event type: "+a;window.addEventListener(a,b,c)}function removeEventListener(a,b,c){if(a!==FAVORITES_CHANGED_EVENT&&a!==FAVORITES_LOADED_EVENT)throw"Invalid event type: "+a;window.removeEventListener(a,b,c)}
function notifyListeners(){var a=FAVORITES_CHANGED_EVENT;if(!loaded){if(!isLoaded())return;loaded=!0;a=FAVORITES_LOADED_EVENT}var b=document.createEvent("CustomEvent");b.initCustomEvent(a,!0,!1,getFavoriteUsers());window.dispatchEvent(b)}function isLoaded(){return social.loaded&&favorites.loaded}function getFavoriteUsers(){var a=map(social.getUserByUri,favorites.all());return filter(function(a){return null!==a},a)}
function addFavoriteUser(a){return!isFavoriteUser(a)?(favorites.add(a),models.User.fromURI(a,function(a){a.data.canonicalUsername&&social.subscribe([a.data.canonicalUsername],function(){})}),!0):!1}function removeFavoriteUser(a){return isFavoriteUser(a)?(favorites.remove(a),!0):!1}function toggleFavoriteUser(a){var b=isFavoriteUser(a);b?removeFavoriteUser(a):addFavoriteUser(a);return!b}function isFavoriteUser(a){return-1!==favorites.all().indexOf(a)};
